<section class="mx-auto w-full max-w-6xl px-6 py-16" id="blog">
  <div class="flex flex-wrap items-end justify-between gap-6">
    <div class="space-y-3">
      <p class="text-xs font-semibold uppercase tracking-[0.3em] text-slate-500">
        Writing
      </p>
      <h2 class="font-display text-3xl font-semibold text-white">
        Notes on operations, delivery, and standards.
      </h2>
      <p class="max-w-2xl text-slate-300">
        Short guides and updates drawn from production work and team collaboration.
      </p>
    </div>
    <a
      href="/blog"
      class="inline-flex items-center gap-2 text-sm font-semibold text-slate-300 transition hover:text-white"
    >
      Read the blog
      <iconify-icon icon="ph:arrow-right-bold"></iconify-icon>
    </a>
  </div>

  <div class="mt-10 grid gap-6 md:grid-cols-3" data-blog-grid>
    <div class="rounded-3xl border border-slate-800 bg-slate-900/60 p-6 text-sm text-slate-400">
      Writing updates will be published here.
    </div>
  </div>
</section>

<script>
  const grid = document.querySelector("[data-blog-grid]");

  const formatDate = (value) => {
    if (!value) return "-";
    const date = new Date(value);
    if (Number.isNaN(date.getTime())) return value;
    return date.toLocaleDateString(undefined, {
      year: "numeric",
      month: "short",
      day: "2-digit",
    });
  };

  const buildCard = (post) => {
    const card = document.createElement("article");
    card.className =
      "flex h-full flex-col rounded-3xl border border-slate-800 bg-slate-900/60 p-6 shadow-sm";

    const date = document.createElement("p");
    date.className =
      "text-xs font-semibold uppercase tracking-[0.2em] text-slate-500";
    date.textContent = formatDate(post.date ?? post.updated_at);

    const title = document.createElement("h3");
    title.className = "mt-3 font-display text-xl font-semibold text-white";
    title.textContent = post.title ?? "Untitled post";

    const summary = document.createElement("p");
    summary.className = "mt-3 text-sm text-slate-300";
    summary.textContent = post.summary ?? "";

    const link = document.createElement("a");
    link.className =
      "mt-auto inline-flex items-center gap-2 pt-6 text-sm font-semibold text-slate-300 transition hover:text-white";
    link.textContent = "Open article";
    link.href = "/blog";

    const icon = document.createElement("iconify-icon");
    icon.setAttribute("icon", "ph:arrow-up-right-bold");
    link.append(icon);

    card.append(date, title, summary, link);
    return card;
  };

  const loadPosts = async () => {
    if (!grid) return;
    try {
      const response = await fetch("/public/blogs");
      if (!response.ok) throw new Error("Failed");
      const json = await response.json();
      const items = json.data ?? [];

      if (!items.length) return;
      grid.innerHTML = "";
      items.forEach((item) => grid.append(buildCard(item)));
    } catch (error) {
      // Keep placeholder
    }
  };

  loadPosts();
</script>
